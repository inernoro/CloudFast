
@{
    ViewBag.Title = "Edit";
}
<div class="row" id="edit">
    <h3 class="text-center">
        {{namespace.actionDisplay}} ({{namespace.actionName}})
    </h3>
    <form role="form">
        <div v-for="node in namespace.inputParantrens" class="form-group">
            <label :for="node.name">
                {{node.description}} ({{node.name}})
            </label>
            <input v-bind:type="node.type | toType node.description" class="form-control" :id="node.name" :placeholder="node.type" />
            <input type="hidden" />
        </div>
        <button type="submit" class="btn btn-default">
            提交
        </button>
    </form>
</div>
<br />
<div class="row">
    <div class="view">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title" contenteditable="false">结果</h3>
            </div>
            <div class="panel-body" contenteditable="true">
                结果集
            </div>
            <div v-if="error && error!=200" class="panel-footer" contenteditable="false">
                状态:{{error}}
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" language="javascript">
    function GetRequest() {
        var url = location.search; //获取url中"?"符后的字串
        var theRequest = new Object();
        if (url.indexOf("?") !== -1) {
            var str = url.substr(1);
            var strs = str.split("&");
            for (var i = 0; i < strs.length; i++) {
                theRequest[strs[i].split("=")[0]] = (strs[i].split("=")[1]);
            }
        }
        return theRequest;
    }

    $(function () {
        $.ajax({
            url: "/api/services/app/Manager/GetInfo",
            data: { input: GetRequest()["url"] },
            type: "Get",
            dataType: "json",
            success: function (data) {
                model.namespace = data.result;
            },
            error: function (e, r) {
                console.log(e, r);
            }
        });
    });

    var model = {
        namespace: new Array(),
        error: false
    }
    var first = true;
    var vue = new Vue({
        el: "#parent",
        data: model,
        filters: {
            toType: function (value, display) { 
                if (!!display) {
                    console.log(1);
                    if (display.indexOf("type:") !== -1) {
                        var field = "type:";
                        var left = display.substring(display.indexOf(field) + field.length);
                        var type = left.substring(0, left.indexOf(")"));
                        console.log(2);
                        switch (type) {
                            case "string":
                                return "text";
                            case "phone":
                                return "tel";
                            case "datetime":
                                return "datetime-local";
                            case "date":
                                return "date";
                            case "time":
                                return "time";
                            case "long":
                            case "int":
                            case "double":
                            case "flolt":
                                return "number";
                            case "bool":
                                return "checkbox";
                            default:
                        }
                    }
                }
                switch (value) {
                    case "Int32":
                    case "Int32(NULL)":
                        return "number";
                    case "String":
                        return "text";
                    case "Boolean":
                    case "Boolean(NULL)":
                        return "checkbox";
                    case "DateTime(NULL)":
                    case "DateTime":
                        return "datetime-local";
                    default:
                        return "text";

                }

            }
        }

    });

</script>